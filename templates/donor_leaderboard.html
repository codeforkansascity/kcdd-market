{% extends 'base.html' %}
{% load static %}

{% block title %}Donor Leaderboard - KCDD Matchmaking Portal{% endblock %}

{% block content %}
<!-- Hero Header Section -->
<section class="relative bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 text-white py-20 overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-0 left-0 w-72 h-72 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl animate-pulse"></div>
        <div class="absolute top-0 right-0 w-72 h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl animate-pulse animation-delay-2000"></div>
        <div class="absolute bottom-0 left-1/2 w-72 h-72 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl animate-pulse animation-delay-4000"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10">
        <div class="text-center max-w-4xl mx-auto">
            <h1 class="text-5xl lg:text-6xl font-bold mb-6 leading-tight">
                Top Donors
                <span class="block text-3xl lg:text-4xl text-purple-200 mt-2">Making a Difference</span>
            </h1>
            <p class="text-xl lg:text-2xl text-purple-100 leading-relaxed max-w-3xl mx-auto">
                Celebrating our amazing donors who are transforming the Kansas City community through technology support and generosity.
            </p>
            
            <!-- Quick Stats -->
            <div class="grid grid-cols-3 gap-8 mt-12 max-w-3xl mx-auto">
                <div class="text-center group">
                    <div class="text-4xl font-bold text-yellow-300 mb-2 group-hover:scale-110 transition-transform duration-300">{{ total_donors }}</div>
                    <div class="text-purple-200 text-sm font-medium">Vetted Donors</div>
                </div>
                <div class="text-center group">
                    <div class="text-4xl font-bold text-green-300 mb-2 group-hover:scale-110 transition-transform duration-300">{{ total_fulfilled }}</div>
                    <div class="text-purple-200 text-sm font-medium">Requests Fulfilled</div>
                </div>
                <div class="text-center group">
                    <div class="text-4xl font-bold text-pink-300 mb-2 group-hover:scale-110 transition-transform duration-300">${{ total_amount|floatformat:0 }}</div>
                    <div class="text-purple-200 text-sm font-medium">Total Donated</div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container mx-auto px-4 py-16">

    <!-- Enhanced Leaderboard Tabs -->
    <div class="bg-white rounded-3xl shadow-2xl border border-gray-100 overflow-hidden mb-16">
        <!-- Tab Headers -->
        <div class="bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200">
            <nav class="flex space-x-1 p-2" aria-label="Tabs">
                <button onclick="showTab('requests')" id="requests-tab" 
                        class="tab-button active py-4 px-6 text-sm font-medium border-b-2 border-blue-500 text-blue-600">
                    ðŸŽ¯ Most Requests Fulfilled
                </button>
                <button onclick="showTab('amount')" id="amount-tab"
                        class="tab-button py-4 px-6 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    ðŸ’° Highest Donations
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div class="p-8">
            <!-- Top Donors by Request Count -->
            <div id="requests-content" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Top Donors by Requests Fulfilled</h2>
                {% if donors_by_count %}
                    <div class="space-y-4">
                        {% for donor in donors_by_count %}
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center space-x-4">
                                <!-- Rank -->
                                <div class="flex-shrink-0">
                                    {% if forloop.counter == 1 %}
                                        <div class="w-10 h-10 bg-yellow-400 text-yellow-900 rounded-full flex items-center justify-center font-bold text-lg">
                                            ðŸ¥‡
                                        </div>
                                    {% elif forloop.counter == 2 %}
                                        <div class="w-10 h-10 bg-gray-300 text-gray-700 rounded-full flex items-center justify-center font-bold text-lg">
                                            ðŸ¥ˆ
                                        </div>
                                    {% elif forloop.counter == 3 %}
                                        <div class="w-10 h-10 bg-orange-400 text-orange-900 rounded-full flex items-center justify-center font-bold text-lg">
                                            ðŸ¥‰
                                        </div>
                                    {% else %}
                                        <div class="w-10 h-10 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center font-bold">
                                            {{ forloop.counter }}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Profile Picture -->
                                <div class="flex-shrink-0">
                                    {% if donor.donor_profile.profile_picture %}
                                        <img src="{{ donor.donor_profile.profile_picture.url }}" 
                                             alt="{{ donor.donor_profile.display_name }}" 
                                             class="w-12 h-12 rounded-full object-cover">
                                    {% else %}
                                        <div class="w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-lg">
                                            {{ donor.donor_profile.display_name|first|upper }}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Donor Info -->
                                <div>
                                    <h3 class="font-semibold text-gray-900">
                                        <a href="{% url 'app:donor_public_profile' donor.username %}" 
                                           class="hover:text-blue-600 transition-colors">
                                            {{ donor.donor_profile.display_name }}
                                        </a>
                                    </h3>
                                    <p class="text-sm text-gray-600">{{ donor.donor_profile.bio|truncatewords:10 }}</p>
                                </div>
                            </div>
                            
                            <!-- Stats -->
                            <div class="text-right">
                                <div class="text-2xl font-bold text-green-600">{{ donor.fulfilled_count }}</div>
                                <div class="text-sm text-gray-500">requests fulfilled</div>
                                <div class="text-lg font-semibold text-gray-700">${{ donor.total_donated|floatformat:0 }}</div>
                                <div class="text-xs text-gray-500">total donated</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-16">
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">No fulfilled requests yet</h3>
                        <p class="text-gray-600 text-lg mb-8 max-w-md mx-auto">Be the first to fulfill a request and appear on the leaderboard!</p>
                        <a href="{% url 'app:request_board' %}" 
                           class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-4 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl">
                            <svg class="w-5 h-5 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                            <span>Browse Requests</span>
                        </a>
                    </div>
                {% endif %}
            </div>

            <!-- Top Donors by Amount -->
            <div id="amount-content" class="tab-content hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Top Donors by Total Amount</h2>
                {% if donors_by_amount %}
                    <div class="space-y-4">
                        {% for donor in donors_by_amount %}
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center space-x-4">
                                <!-- Rank -->
                                <div class="flex-shrink-0">
                                    {% if forloop.counter == 1 %}
                                        <div class="w-10 h-10 bg-yellow-400 text-yellow-900 rounded-full flex items-center justify-center font-bold text-lg">
                                            ðŸ¥‡
                                        </div>
                                    {% elif forloop.counter == 2 %}
                                        <div class="w-10 h-10 bg-gray-300 text-gray-700 rounded-full flex items-center justify-center font-bold text-lg">
                                            ðŸ¥ˆ
                                        </div>
                                    {% elif forloop.counter == 3 %}
                                        <div class="w-10 h-10 bg-orange-400 text-orange-900 rounded-full flex items-center justify-center font-bold text-lg">
                                            ðŸ¥‰
                                        </div>
                                    {% else %}
                                        <div class="w-10 h-10 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center font-bold">
                                            {{ forloop.counter }}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Profile Picture -->
                                <div class="flex-shrink-0">
                                    {% if donor.donor_profile.profile_picture %}
                                        <img src="{{ donor.donor_profile.profile_picture.url }}" 
                                             alt="{{ donor.donor_profile.display_name }}" 
                                             class="w-12 h-12 rounded-full object-cover">
                                    {% else %}
                                        <div class="w-12 h-12 bg-purple-500 text-white rounded-full flex items-center justify-center font-bold text-lg">
                                            {{ donor.donor_profile.display_name|first|upper }}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Donor Info -->
                                <div>
                                    <h3 class="font-semibold text-gray-900">
                                        <a href="{% url 'app:donor_public_profile' donor.username %}" 
                                           class="hover:text-purple-600 transition-colors">
                                            {{ donor.donor_profile.display_name }}
                                        </a>
                                    </h3>
                                    <p class="text-sm text-gray-600">{{ donor.donor_profile.bio|truncatewords:10 }}</p>
                                </div>
                            </div>
                            
                            <!-- Stats -->
                            <div class="text-right">
                                <div class="text-2xl font-bold text-purple-600">${{ donor.total_donated|floatformat:0 }}</div>
                                <div class="text-sm text-gray-500">total donated</div>
                                <div class="text-lg font-semibold text-gray-700">{{ donor.fulfilled_count }}</div>
                                <div class="text-xs text-gray-500">requests fulfilled</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-16">
                        <div class="text-8xl mb-6 animate-bounce">ðŸ’°</div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">No donations yet</h3>
                        <p class="text-gray-600 text-lg mb-8 max-w-md mx-auto">Be the first to make a donation and appear on the leaderboard!</p>
                        <a href="{% url 'app:request_board' %}" 
                           class="inline-flex items-center gap-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white px-8 py-4 rounded-xl font-semibold hover:from-purple-700 hover:to-purple-800 transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl">
                            <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                            </svg>
                            <span>Become a Donor</span>
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Enhanced Call to Action -->
    <div class="text-center">
        <div class="bg-gradient-to-r from-blue-50 via-purple-50 to-indigo-50 rounded-3xl p-12 shadow-xl border border-gray-100">
            <div class="max-w-3xl mx-auto">
                <h3 class="text-3xl font-bold text-gray-900 mb-6">Ready to join our amazing donors?</h3>
                <p class="text-gray-600 text-lg mb-8 leading-relaxed">
                    Browse available technology requests and start making a real difference in your community today. 
                    Every contribution, no matter the size, helps bridge the digital divide in Kansas City.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="{% url 'app:request_board' %}" 
                       class="group bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-4 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
                        <svg class="w-5 h-5 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <span>Browse Requests</span>
                    </a>
                    {% if not user.is_authenticated %}
                    <a href="{% url 'app:register' %}" 
                       class="group bg-gradient-to-r from-purple-600 to-purple-700 text-white px-8 py-4 rounded-xl font-semibold hover:from-purple-700 hover:to-purple-800 transition-all duration-300 transform hover:-translate-y-1 shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
                        <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                        <span>Become a Donor</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Remove active class from all tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active', 'border-blue-500', 'text-blue-600', 'border-purple-500', 'text-purple-600', 'bg-blue-50', 'bg-purple-50');
        button.classList.add('border-transparent', 'text-gray-600');
    });
    
    // Show selected tab content
    document.getElementById(tabName + '-content').classList.remove('hidden');
    
    // Activate selected tab button
    const activeButton = document.getElementById(tabName + '-tab');
    activeButton.classList.remove('border-transparent', 'text-gray-600');
    activeButton.classList.add('active');
    
    if (tabName === 'requests') {
        activeButton.classList.add('border-blue-500', 'text-blue-600', 'bg-blue-50');
    } else {
        activeButton.classList.add('border-purple-500', 'text-purple-600', 'bg-purple-50');
    }
}
</script>
{% endblock %}
